# --- ROCK-COPYRIGHT-NOTE-BEGIN ---
# 
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
# Please add additional copyright information _after_ the line containing
# the ROCK-COPYRIGHT-NOTE-END tag. Otherwise it might get removed by
# the ./scripts/Create-CopyPatch script. Do not edit this copyright text!
# 
# ROCK Linux: rock-src/package/base/pam/pic-and-linker.patch
# ROCK Linux is Copyright (C) 1998 - 2004 Clifford Wolf
# 
# This patch file is dual-licensed. It is available under the license the
# patched project is licensed under, as long as it is an OpenSource license
# as defined at http://www.opensource.org/ (e.g. BSD, X11) or under the terms
# of the GNU General Public License as published by the Free Software
# Foundation; either version 2 of the License, or (at your option) any later
# version.
# 
# --- ROCK-COPYRIGHT-NOTE-END ---

diff -durN -X ../scripts/dontdiff Linux-PAM-0.77-orig/configure.in Linux-PAM-0.77-new/configure.in
--- Linux-PAM-0.77-orig/configure.in	2002-07-09 08:17:13.000000000 +0200
+++ Linux-PAM-0.77-new/configure.in	2003-05-01 03:13:16.000000000 +0200
@@ -309,8 +309,9 @@
 		WARNINGS="$GCC_WARNINGS"
 		PIC="-fPIC"
 		DYNTYPE=so
-		LD=ld				
-		LD_L="$LD -x -shared"
+		LD=gcc
+		LD_L="$LD -shared -Xlinker -x"
+		SOSWITCH="-Xlinker -soname -Xlinker"
 		RANLIB=ranlib
 		STRIP=strip
 		CC_STATIC="-Xlinker -export-dynamic"
diff -durN -X ../scripts/dontdiff Linux-PAM-0.77-orig/configure Linux-PAM-0.77-new/configure
--- Linux-PAM-0.77-orig/configure	2002-07-09 08:17:13.000000000 +0200
+++ Linux-PAM-0.77-new/configure	2003-05-01 03:13:43.000000000 +0200
@@ -2479,8 +2479,9 @@
 		WARNINGS="$GCC_WARNINGS"
 		PIC="-fPIC"
 		DYNTYPE=so
-		LD=ld				
-		LD_L="$LD -x -shared"
+		LD=gcc
+		LD_L="$LD -shared -Xlinker -x"
+		SOSWITCH="-Xlinker -soname -Xlinker"
 		RANLIB=ranlib
 		STRIP=strip
 		CC_STATIC="-Xlinker -export-dynamic"

diff -durN -X ../scripts/dontdiff Linux-PAM-0.77-orig/libpam/Makefile Linux-PAM-0.77-new/libpam/Makefile
--- Linux-PAM-0.77-orig/libpam/Makefile	2001-12-09 22:44:58.000000000 +0100
+++ Linux-PAM-0.77-new/libpam/Makefile	2003-05-01 03:16:37.000000000 +0200
@@ -84,7 +84,7 @@
 endif
 
 dynamic/%.o : %.c
-	$(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -c $< -o $@
+	$(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) $(PIC) -c $< -o $@
 
 static/%.o : %.c
 	$(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -c $< -o $@
diff -durN -X ../scripts/dontdiff Linux-PAM-0.77-orig/libpamc/Makefile Linux-PAM-0.77-new/libpamc/Makefile
--- Linux-PAM-0.77-orig/libpamc/Makefile	2001-02-10 08:17:53.000000000 +0100
+++ Linux-PAM-0.77-new/libpamc/Makefile	2003-05-01 03:17:07.000000000 +0200
@@ -51,7 +51,7 @@
 endif
 
 dynamic/%.o : %.c
-	$(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -c $< -o $@
+	$(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) $(PIC) -c $< -o $@
 
 static/%.o : %.c
 	$(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -c $< -o $@
diff -durN -X ../scripts/dontdiff Linux-PAM-0.77-orig/libpam_misc/Makefile Linux-PAM-0.77-new/libpam_misc/Makefile
--- Linux-PAM-0.77-orig/libpam_misc/Makefile	2002-06-27 06:04:54.000000000 +0200
+++ Linux-PAM-0.77-new/libpam_misc/Makefile	2003-05-01 03:16:54.000000000 +0200
@@ -52,7 +52,7 @@
 endif
 
 dynamic/%.o : %.c
-	$(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -c $< -o $@
+	$(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) $(PIC) -c $< -o $@
 
 static/%.o : %.c
 	$(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -c $< -o $@
diff -durN -X ../scripts/dontdiff Linux-PAM-0.77-orig/modules/Simple.Rules Linux-PAM-0.77-new/modules/Simple.Rules
--- Linux-PAM-0.77-orig/modules/Simple.Rules	2001-12-09 23:15:11.000000000 +0100
+++ Linux-PAM-0.77-new/modules/Simple.Rules	2003-05-01 03:17:41.000000000 +0200
@@ -35,7 +35,7 @@
 all: dirs $(LIBSHARED) $(LIBSTATIC) register
 
 dynamic/%.o : %.c
-	$(CC) $(CFLAGS) $(INCLUDE_PAMMODUTILS) $(DYNAMIC) $(TARGET_ARCH) -c $< -o $@
+	$(CC) $(CFLAGS) $(INCLUDE_PAMMODUTILS) $(DYNAMIC) $(TARGET_ARCH) $(PIC) -c $< -o $@
 
 static/%.o : %.c
 	$(CC) $(CFLAGS) $(INCLUDE_PAMMODUTILS) $(STATIC) $(TARGET_ARCH) -c $< -o $@
