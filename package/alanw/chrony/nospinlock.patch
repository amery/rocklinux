# --- ROCK-COPYRIGHT-NOTE-BEGIN ---
# 
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
# Please add additional copyright information _after_ the line containing
# the ROCK-COPYRIGHT-NOTE-END tag. Otherwise it might get removed by
# the ./scripts/Create-CopyPatch script. Do not edit this copyright text!
# 
# ROCK Linux: rock-src/package/alanw/chrony/nospinlock.patch
# ROCK Linux is Copyright (C) 1998 - 2006 Clifford Wolf
# 
# This patch file is dual-licensed. It is available under the license the
# patched project is licensed under, as long as it is an OpenSource license
# as defined at http://www.opensource.org/ (e.g. BSD, X11) or under the terms
# of the GNU General Public License as published by the Free Software
# Foundation; either version 2 of the License, or (at your option) any later
# version.
# 
# --- ROCK-COPYRIGHT-NOTE-END ---

diff -Naur chrony-1.20.orig/configure chrony-1.20/configure
--- chrony-1.20.orig/configure	2003-09-22 22:53:57.000000000 +0100
+++ chrony-1.20/configure	2005-04-10 09:13:06.000000000 +0100
@@ -241,12 +241,6 @@
         EXTRA_OBJECTS="sys_linux.o wrap_adjtimex.o rtc_linux.o"
         SYSDEFS="-DLINUX"
         echo "Configuring for " $SYSTEM
-        if [ -r /usr/include/linux/spinlock.h ]; then
-            SYSDEFS="$SYSDEFS -DHAS_SPINLOCK_H"
-            echo "The system has <spinlock.h>, using that"
-        else
-            echo "The system does not have <spinlock.h>, using private definition for spinlock_t"
-        fi
 	if [ "${MACHINE}" = "alpha" ]; then
 	   echo "Enabling -mieee"
 	   # FIXME: Should really test for GCC
diff -Naur chrony-1.20.orig/rtc_linux.c chrony-1.20/rtc_linux.c
--- chrony-1.20.orig/rtc_linux.c	2003-09-22 22:22:30.000000000 +0100
+++ chrony-1.20/rtc_linux.c	2005-04-10 09:13:20.000000000 +0100
@@ -43,13 +43,6 @@
 #include <sys/time.h>
 #include <sys/types.h>
 
-#ifdef HAS_SPINLOCK_H
-#include <linux/spinlock.h>
-#else
-/* Include dummy definition of spinlock_t to cope with earlier kernels. */
-typedef int spinlock_t;
-#endif
-
 /* This is a complete hack since the alpha sys/io.h needs these types
  * but does not arrange them to be defined.  This is almost certainly
  * not how one should do these things.  -- broonie
