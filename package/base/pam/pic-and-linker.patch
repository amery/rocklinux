# --- ROCK-COPYRIGHT-NOTE-BEGIN ---
# 
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
# Please add additional copyright information _after_ the line containing
# the ROCK-COPYRIGHT-NOTE-END tag. Otherwise it might get removed by
# the ./scripts/Create-CopyPatch script. Do not edit this copyright text!
# 
# ROCK Linux: rock-src/package/base/pam/pic-and-linker.patch
# ROCK Linux is Copyright (C) 1998 - 2004 Clifford Wolf
# 
# This patch file is dual-licensed. It is available under the license the
# patched project is licensed under, as long as it is an OpenSource license
# as defined at http://www.opensource.org/ (e.g. BSD, X11) or under the terms
# of the GNU General Public License as published by the Free Software
# Foundation; either version 2 of the License, or (at your option) any later
# version.
# 
# --- ROCK-COPYRIGHT-NOTE-END ---

diff -durN Linux-PAM-0.77-orig/configure Linux-PAM-0.77/configure
--- Linux-PAM-0.77-orig/configure	2002-07-09 08:17:13.000000000 +0200
+++ Linux-PAM-0.77/configure	2004-11-19 11:22:20.616688200 +0100
@@ -2479,8 +2479,9 @@
 		WARNINGS="$GCC_WARNINGS"
 		PIC="-fPIC"
 		DYNTYPE=so
-		LD=ld				
-		LD_L="$LD -x -shared"
+		LD=gcc
+		LD_L="$LD -shared -Xlinker -x"
+		SOSWITCH="-Xlinker -soname -Xlinker"
 		RANLIB=ranlib
 		STRIP=strip
 		CC_STATIC="-Xlinker -export-dynamic"
diff -durN Linux-PAM-0.77-orig/configure.in Linux-PAM-0.77/configure.in
--- Linux-PAM-0.77-orig/configure.in	2002-07-09 08:17:13.000000000 +0200
+++ Linux-PAM-0.77/configure.in	2004-11-19 11:22:20.614688504 +0100
@@ -309,8 +309,9 @@
 		WARNINGS="$GCC_WARNINGS"
 		PIC="-fPIC"
 		DYNTYPE=so
-		LD=ld				
-		LD_L="$LD -x -shared"
+		LD=gcc
+		LD_L="$LD -shared -Xlinker -x"
+		SOSWITCH="-Xlinker -soname -Xlinker"
 		RANLIB=ranlib
 		STRIP=strip
 		CC_STATIC="-Xlinker -export-dynamic"
diff -durN Linux-PAM-0.77-orig/libpam/Makefile Linux-PAM-0.77/libpam/Makefile
--- Linux-PAM-0.77-orig/libpam/Makefile	2001-12-09 22:44:58.000000000 +0100
+++ Linux-PAM-0.77/libpam/Makefile	2004-11-19 11:22:20.616688200 +0100
@@ -84,7 +84,7 @@
 endif
 
 dynamic/%.o : %.c
-	$(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -c $< -o $@
+	$(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) $(PIC) -c $< -o $@
 
 static/%.o : %.c
 	$(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -c $< -o $@
diff -durN Linux-PAM-0.77-orig/libpamc/Makefile Linux-PAM-0.77/libpamc/Makefile
--- Linux-PAM-0.77-orig/libpamc/Makefile	2001-02-10 08:17:53.000000000 +0100
+++ Linux-PAM-0.77/libpamc/Makefile	2004-11-19 11:22:20.617688048 +0100
@@ -51,7 +51,7 @@
 endif
 
 dynamic/%.o : %.c
-	$(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -c $< -o $@
+	$(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) $(PIC) -c $< -o $@
 
 static/%.o : %.c
 	$(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -c $< -o $@
diff -durN Linux-PAM-0.77-orig/libpam_misc/Makefile Linux-PAM-0.77/libpam_misc/Makefile
--- Linux-PAM-0.77-orig/libpam_misc/Makefile	2002-06-27 06:04:54.000000000 +0200
+++ Linux-PAM-0.77/libpam_misc/Makefile	2004-11-19 11:22:20.617688048 +0100
@@ -52,7 +52,7 @@
 endif
 
 dynamic/%.o : %.c
-	$(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -c $< -o $@
+	$(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) $(PIC) -c $< -o $@
 
 static/%.o : %.c
 	$(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -c $< -o $@
diff -durN Linux-PAM-0.77-orig/modules/pam_filter/Makefile Linux-PAM-0.77/modules/pam_filter/Makefile
--- Linux-PAM-0.77-orig/modules/pam_filter/Makefile	2001-11-11 08:43:54.000000000 +0100
+++ Linux-PAM-0.77/modules/pam_filter/Makefile	2004-11-19 11:22:39.087880152 +0100
@@ -29,7 +29,7 @@
 LIBOBJS = $(addprefix static/,$(LIBOBJ))
 
 dynamic/%.o : %.c
-	$(CC) $(CFLAGS) $(DYNAMIC) $(CPPFLAGS) $(TARGET_ARCH) -c $< -o $@
+	$(CC) $(CFLAGS) $(DYNAMIC) $(CPPFLAGS) $(TARGET_ARCH) $(PIC) -c $< -o $@
 
 static/%.o : %.c
 	$(CC) $(CFLAGS) $(STATIC) $(CPPFLAGS) $(TARGET_ARCH) -c $< -o $@
diff -durN Linux-PAM-0.77-orig/modules/pam_tally/Makefile Linux-PAM-0.77/modules/pam_tally/Makefile
--- Linux-PAM-0.77-orig/modules/pam_tally/Makefile	2001-06-27 08:20:43.000000000 +0200
+++ Linux-PAM-0.77/modules/pam_tally/Makefile	2004-11-19 11:22:39.087880152 +0100
@@ -27,7 +27,7 @@
 APPOBJS = $(addprefix static/,$(APPOBJ))
     
 dynamic/%.o : %.c
-	$(CC) $(CFLAGS) $(DYNAMIC) $(CPPFLAGS) $(TARGET_ARCH) -c $< -o $@
+	$(CC) $(CFLAGS) $(DYNAMIC) $(CPPFLAGS) $(TARGET_ARCH) $(PIC) -c $< -o $@
 
 static/%.o : %.c
 	$(CC) $(CFLAGS) $(STATIC) $(CPPFLAGS) $(TARGET_ARCH) -c $< -o $@
diff -durN Linux-PAM-0.77-orig/modules/pam_unix/Makefile Linux-PAM-0.77/modules/pam_unix/Makefile
--- Linux-PAM-0.77-orig/modules/pam_unix/Makefile	2001-02-11 07:33:53.000000000 +0100
+++ Linux-PAM-0.77/modules/pam_unix/Makefile	2004-11-19 11:22:39.087880152 +0100
@@ -72,7 +72,7 @@
 all: dirs info $(PLUS) $(LIBSHARED) $(LIBSTATIC) $(CHKPWD) register
 
 dynamic/%.o : %.c
-	$(CC) $(CFLAGS) $(DYNAMIC) $(CPPFLAGS) $(TARGET_ARCH) -c $< -o $@
+	$(CC) $(CFLAGS) $(DYNAMIC) $(CPPFLAGS) $(TARGET_ARCH) $(PIC) -c $< -o $@
 
 static/%.o: %.c
 	$(CC) $(CFLAGS) $(STATIC) $(CPPFLAGS) $(TARGET_ARCH) -c $< -o $@
@@ -125,21 +125,27 @@
 unix_chkpwd.o: unix_chkpwd.c
 	$(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -c $< -o $@
 
+yppasswd_xdr.o: yppasswd_xdr.c
+	$(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) $(PIC) -c $< -o $@
+
+bigcrypt.o: bigcrypt.c
+	$(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) $(PIC) -c $< -o $@
+
 md5_good.o: md5.c
 	$(CC) $(CFLAGS) $(CPPFLAGS) -DHIGHFIRST -D'MD5Name(x)=Good##x' \
-		$(TARGET_ARCH) -c $< -o $@
+		$(TARGET_ARCH) $(PIC) -c $< -o $@
 
 md5_broken.o: md5.c
 	$(CC) $(CFLAGS) $(CPPFLAGS) -D'MD5Name(x)=Broken##x' \
-		$(TARGET_ARCH) -c $< -o $@
+		$(TARGET_ARCH) $(PIC) -c $< -o $@
 
 md5_crypt_good.o: md5_crypt.c
 	$(CC) $(CFLAGS) $(CPPFLAGS) -D'MD5Name(x)=Good##x' \
-		$(TARGET_ARCH) -c $< -o $@
+		$(TARGET_ARCH) $(PIC) -c $< -o $@
 
 md5_crypt_broken.o: md5_crypt.c
 	$(CC) $(CFLAGS) $(CPPFLAGS) -D'MD5Name(x)=Broken##x' \
-		$(TARGET_ARCH) -c $< -o $@
+		$(TARGET_ARCH) $(PIC) -c $< -o $@
 
 install: all
 	mkdir -p $(FAKEROOT)$(SECUREDIR)
diff -durN Linux-PAM-0.77-orig/modules/Simple.Rules Linux-PAM-0.77/modules/Simple.Rules
--- Linux-PAM-0.77-orig/modules/Simple.Rules	2001-12-09 23:15:11.000000000 +0100
+++ Linux-PAM-0.77/modules/Simple.Rules	2004-11-19 11:22:20.617688048 +0100
@@ -35,7 +35,7 @@
 all: dirs $(LIBSHARED) $(LIBSTATIC) register
 
 dynamic/%.o : %.c
-	$(CC) $(CFLAGS) $(INCLUDE_PAMMODUTILS) $(DYNAMIC) $(TARGET_ARCH) -c $< -o $@
+	$(CC) $(CFLAGS) $(INCLUDE_PAMMODUTILS) $(DYNAMIC) $(TARGET_ARCH) $(PIC) -c $< -o $@
 
 static/%.o : %.c
 	$(CC) $(CFLAGS) $(INCLUDE_PAMMODUTILS) $(STATIC) $(TARGET_ARCH) -c $< -o $@
