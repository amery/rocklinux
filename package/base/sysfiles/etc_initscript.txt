# --- ROCK-COPYRIGHT-NOTE-BEGIN ---
# 
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
# Please add additional copyright information _after_ the line containing
# the ROCK-COPYRIGHT-NOTE-END tag. Otherwise it might get removed by
# the ./scripts/Create-CopyPatch script. Do not edit this copyright text!
# 
# ROCK Linux: rock-src/package/base/sysfiles/etc_initscript.txt
# ROCK Linux is Copyright (C) 1998 - 2005 Clifford Wolf
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version. A copy of the GNU General Public
# License can be found at Documentation/COPYING.
# 
# Many people helped and are helping developing ROCK Linux. Please
# have a look at http://www.rocklinux.org/ and the Documentation/TEAM
# file for details.
# 
# --- ROCK-COPYRIGHT-NOTE-END ---

# Set umask to safe level, and enable core dumps.
#
umask 022
ulimit -c 2097151
PATH=/bin:/sbin:/usr/bin:/usr/sbin
export PATH

# Do the dev filesystem magic
#
if [ -z "$devtype" ]; then
	devtype=devfs
	if [ -f /etc/conf/devtype ]; then
		. /etc/conf/devtype
	fi
fi
case "$devtype" in
    devfs)
	if ! [ -e /dev/.devfsd ] ; then
		mount -v -n -t devfs none /dev
		exec > /dev/console 2>&1 < /dev/console
		echo "Mounted /dev (devfs) from /etc/initscript."
	fi
	;;

    udev)
	if ! [ -e /dev/.udevdb ] ; then
		if [ -e /dev/.devfsd ]; then
			mount --move /dev /etc/udev
			mount -t ramfs none /dev
			mkdir /dev/devfs
			mount --move /etc/udev /dev/devfs
		else
			mount -t ramfs none /dev
		fi
		mount -n /sys; mount -n /proc
		mkdir -p /dev/pts /dev/shm
		/sbin/udevstart
		exec > /dev/console 2>&1 < /dev/console
		echo "Mounted /dev (udev) from /etc/initscript."
	fi
	;;
    static)
	if ! [ -e /dev/.devfsd ] ; then
		umount -l -n /dev
		echo "Umounted /dev (devfs) from /etc/initscript."
	fi
	;;
    *)
	if ! [ -e /dev/console ]; then
		mount -t ramfs none /dev
		mknod -m 600 /dev/console c 5 1
	fi
	exec > /dev/console 2>&1 < /dev/console
	echo "Unrecognized devtype=$devtype option caught in /etc/initscript."
	;;
esac
unset devtype

# Execute the program.
#
eval exec "$4" > /dev/console 2>&1 < /dev/console
